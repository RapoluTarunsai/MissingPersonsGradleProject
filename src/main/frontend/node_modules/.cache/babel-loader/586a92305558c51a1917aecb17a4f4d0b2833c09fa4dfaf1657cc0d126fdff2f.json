{"ast":null,"code":"import React,{useState,useEffect,useRef}from'react';import axios from'axios';import{format}from'date-fns';import styles from'../styles/groupdiscussions.module.css';import{useNavigate}from'react-router-dom';import{toast}from'react-toastify';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function GroupDiscussions(_ref){let{missingPersonId}=_ref;const[discussions,setDiscussions]=useState([]);const[newMessage,setNewMessage]=useState('');const[error,setError]=useState('');const[isSubmitting,setIsSubmitting]=useState(false);const[isListening,setIsListening]=useState(false);const navigate=useNavigate();const recognitionRef=useRef(null);// Initialize Speech Recognition\nuseEffect(()=>{// Check browser support\nconst SpeechRecognition=window.SpeechRecognition||window.webkitSpeechRecognition;if(SpeechRecognition){recognitionRef.current=new SpeechRecognition();recognitionRef.current.continuous=false;recognitionRef.current.interimResults=false;recognitionRef.current.lang='en-US';recognitionRef.current.onresult=event=>{const transcript=event.results[0][0].transcript;setNewMessage(prevMessage=>prevMessage+' '+transcript);setIsListening(false);};recognitionRef.current.onerror=event=>{console.error('Speech recognition error',event.error);setIsListening(false);toast.error('Voice recognition failed');};}else{toast.warn('Speech recognition not supported in this browser');}},[]);// Existing fetchDiscussions method...\nconst handleVoiceInput=()=>{if(recognitionRef.current){if(isListening){recognitionRef.current.stop();setIsListening(false);}else{try{recognitionRef.current.start();setIsListening(true);toast.info('Listening... Speak now');}catch(error){console.error('Voice input error',error);toast.error('Could not start voice input');}}}else{toast.warn('Voice input not supported');}};const handleSubmit=async e=>{e.preventDefault();const token=sessionStorage.getItem('token')||localStorage.getItem('token');if(!token){localStorage.setItem('redirectUrl',window.location.pathname);navigate('/');return;}// Trim whitespace and check message length\nconst trimmedMessage=newMessage.trim();if(!trimmedMessage){toast.error('Message cannot be empty');return;}setIsSubmitting(true);try{const response=await axios.post(\"/api/missing-persons/\".concat(missingPersonId,\"/discussions\"),null,{params:{message:trimmedMessage}});setDiscussions([response.data,...discussions]);setNewMessage('');}catch(err){var _err$response;if(((_err$response=err.response)===null||_err$response===void 0?void 0:_err$response.status)===401){sessionStorage.setItem('redirectUrl',window.location.pathname);navigate('/');return;}setError('Failed to post message. Please try again.');}finally{setIsSubmitting(false);}};return/*#__PURE__*/_jsxs(\"div\",{className:styles.discussionsContainer,children:[/*#__PURE__*/_jsx(\"h3\",{className:styles.title,children:\"Community Group Discussions\"}),error&&/*#__PURE__*/_jsx(\"div\",{className:styles.errorMessage,children:error}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,className:styles.messageForm,children:[/*#__PURE__*/_jsxs(\"div\",{className:styles.inputContainer,children:[/*#__PURE__*/_jsx(\"textarea\",{value:newMessage,onChange:e=>setNewMessage(e.target.value),placeholder:\"Share your thoughts or updates...\",className:styles.messageInput,required:true}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:handleVoiceInput,className:\"\".concat(styles.voiceButton,\" \").concat(isListening?styles.listening:''),\"aria-label\":\"Voice Input\",children:/*#__PURE__*/_jsx(\"i\",{className:\"fas \".concat(isListening?'fa-stop':'fa-microphone')})})]}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:styles.submitButton,disabled:isSubmitting,children:isSubmitting?'Posting...':'Post Message'})]})]});}export default GroupDiscussions;","map":{"version":3,"names":["React","useState","useEffect","useRef","axios","format","styles","useNavigate","toast","jsx","_jsx","jsxs","_jsxs","GroupDiscussions","_ref","missingPersonId","discussions","setDiscussions","newMessage","setNewMessage","error","setError","isSubmitting","setIsSubmitting","isListening","setIsListening","navigate","recognitionRef","SpeechRecognition","window","webkitSpeechRecognition","current","continuous","interimResults","lang","onresult","event","transcript","results","prevMessage","onerror","console","warn","handleVoiceInput","stop","start","info","handleSubmit","e","preventDefault","token","sessionStorage","getItem","localStorage","setItem","location","pathname","trimmedMessage","trim","response","post","concat","params","message","data","err","_err$response","status","className","discussionsContainer","children","title","errorMessage","onSubmit","messageForm","inputContainer","value","onChange","target","placeholder","messageInput","required","type","onClick","voiceButton","listening","submitButton","disabled"],"sources":["C:/Users/tarun/Downloads/MissingPersonsGradleProject/MissingPersonsGradleProject/src/main/frontend/src/components/GroupDiscussions.js"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\r\nimport axios from 'axios';\r\nimport { format } from 'date-fns';\r\nimport styles from '../styles/groupdiscussions.module.css';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { toast } from 'react-toastify';\r\n\r\nfunction GroupDiscussions({ missingPersonId }) {\r\n    const [discussions, setDiscussions] = useState([]);\r\n    const [newMessage, setNewMessage] = useState('');\r\n    const [error, setError] = useState('');\r\n    const [isSubmitting, setIsSubmitting] = useState(false);\r\n    const [isListening, setIsListening] = useState(false);\r\n    const navigate = useNavigate();\r\n    const recognitionRef = useRef(null);\r\n\r\n    // Initialize Speech Recognition\r\n    useEffect(() => {\r\n        // Check browser support\r\n        const SpeechRecognition =\r\n            window.SpeechRecognition ||\r\n            window.webkitSpeechRecognition;\r\n\r\n        if (SpeechRecognition) {\r\n            recognitionRef.current = new SpeechRecognition();\r\n            recognitionRef.current.continuous = false;\r\n            recognitionRef.current.interimResults = false;\r\n            recognitionRef.current.lang = 'en-US';\r\n\r\n            recognitionRef.current.onresult = (event) => {\r\n                const transcript = event.results[0][0].transcript;\r\n                setNewMessage(prevMessage => prevMessage + ' ' + transcript);\r\n                setIsListening(false);\r\n            };\r\n\r\n            recognitionRef.current.onerror = (event) => {\r\n                console.error('Speech recognition error', event.error);\r\n                setIsListening(false);\r\n                toast.error('Voice recognition failed');\r\n            };\r\n        } else {\r\n            toast.warn('Speech recognition not supported in this browser');\r\n        }\r\n    }, []);\r\n\r\n    // Existing fetchDiscussions method...\r\n\r\n    const handleVoiceInput = () => {\r\n        if (recognitionRef.current) {\r\n            if (isListening) {\r\n                recognitionRef.current.stop();\r\n                setIsListening(false);\r\n            } else {\r\n                try {\r\n                    recognitionRef.current.start();\r\n                    setIsListening(true);\r\n                    toast.info('Listening... Speak now');\r\n                } catch (error) {\r\n                    console.error('Voice input error', error);\r\n                    toast.error('Could not start voice input');\r\n                }\r\n            }\r\n        } else {\r\n            toast.warn('Voice input not supported');\r\n        }\r\n    };\r\n\r\n    const handleSubmit = async (e) => {\r\n        e.preventDefault();\r\n        const token = sessionStorage.getItem('token') || localStorage.getItem('token');\r\n        if (!token) {\r\n            localStorage.setItem('redirectUrl', window.location.pathname);\r\n            navigate('/');\r\n            return;\r\n        }\r\n\r\n        // Trim whitespace and check message length\r\n        const trimmedMessage = newMessage.trim();\r\n        if (!trimmedMessage) {\r\n            toast.error('Message cannot be empty');\r\n            return;\r\n        }\r\n\r\n        setIsSubmitting(true);\r\n        try {\r\n            const response = await axios.post(`/api/missing-persons/${missingPersonId}/discussions`, null, {\r\n                params: { message: trimmedMessage }\r\n            });\r\n            setDiscussions([response.data, ...discussions]);\r\n            setNewMessage('');\r\n        } catch (err) {\r\n            if (err.response?.status === 401) {\r\n                sessionStorage.setItem('redirectUrl', window.location.pathname);\r\n                navigate('/');\r\n                return;\r\n            }\r\n            setError('Failed to post message. Please try again.');\r\n        } finally {\r\n            setIsSubmitting(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className={styles.discussionsContainer}>\r\n            <h3 className={styles.title}>Community Group Discussions</h3>\r\n            {error && <div className={styles.errorMessage}>{error}</div>}\r\n\r\n            <form onSubmit={handleSubmit} className={styles.messageForm}>\r\n                <div className={styles.inputContainer}>\r\n                    <textarea\r\n                        value={newMessage}\r\n                        onChange={(e) => setNewMessage(e.target.value)}\r\n                        placeholder=\"Share your thoughts or updates...\"\r\n                        className={styles.messageInput}\r\n                        required\r\n                    />\r\n                    <button\r\n                        type=\"button\"\r\n                        onClick={handleVoiceInput}\r\n                        className={`${styles.voiceButton} ${isListening ? styles.listening : ''}`}\r\n                        aria-label=\"Voice Input\"\r\n                    >\r\n                        <i className={`fas ${isListening ? 'fa-stop' : 'fa-microphone'}`}></i>\r\n                    </button>\r\n                </div>\r\n                <button\r\n                    type=\"submit\"\r\n                    className={styles.submitButton}\r\n                    disabled={isSubmitting}\r\n                >\r\n                    {isSubmitting ? 'Posting...' : 'Post Message'}\r\n                </button>\r\n            </form>\r\n\r\n            {/* Rest of the existing component remains the same */}\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default GroupDiscussions;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}